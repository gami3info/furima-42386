// superagent@3.8.3 downloaded from https://ga.jspm.io/npm:superagent@3.8.3/lib/client.js

import e from"component-emitter";import t from"./is-object.js";import r from"./request-base.js";import"./utils.js";import s from"./response-base.js";import n from"./agent-base.js";var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};var a;if("undefined"!==typeof window)a=window;else if("undefined"!==typeof self)a=self;else{console.warn("Using browser-only version of superagent in non-browser environment");a=i}var u=e;var p=r;var h=t;var l=s;var c=n;function noop(){}var f=i=i=function(e,t){return"function"==typeof t?new i.Request("GET",e).end(t):1==arguments.length?new i.Request("GET",e):new i.Request(e,t)};i.Request=Request;f.getXHR=function(){if(!(!a.XMLHttpRequest||a.location&&"file:"==a.location.protocol&&a.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var d="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function serialize(e){if(!h(e))return e;var t=[];for(var r in e)pushEncodedKeyValuePair(t,r,e[r]);return t.join("&")}function pushEncodedKeyValuePair(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach((function(r){pushEncodedKeyValuePair(e,t,r)}));else if(h(r))for(var s in r)pushEncodedKeyValuePair(e,t+"["+s+"]",r[s]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}f.serializeObject=serialize;function parseString(e){var t={};var r=e.split("&");var s;var n;for(var o=0,i=r.length;o<i;++o){s=r[o];n=s.indexOf("=");-1==n?t[decodeURIComponent(s)]="":t[decodeURIComponent(s.slice(0,n))]=decodeURIComponent(s.slice(n+1))}return t}f.parseString=parseString;f.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};f.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};f.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(e){var t=e.split(/\r?\n/);var r={};var s;var n;var o;var i;for(var a=0,u=t.length;a<u;++a){n=t[a];s=n.indexOf(":");if(-1!==s){o=n.slice(0,s).toLowerCase();i=d(n.slice(s+1));r[o]=i}}return r}function isJSON(e){return/[\/+]json($|[^-\w])/.test(e)}function Response(e){(this||o).req=e;(this||o).xhr=(this||o).req.xhr;(this||o).text="HEAD"!=(this||o).req.method&&(""===(this||o).xhr.responseType||"text"===(this||o).xhr.responseType)||"undefined"===typeof(this||o).xhr.responseType?(this||o).xhr.responseText:null;(this||o).statusText=(this||o).req.xhr.statusText;var t=(this||o).xhr.status;1223===t&&(t=204);this._setStatusProperties(t);(this||o).header=(this||o).headers=parseHeader((this||o).xhr.getAllResponseHeaders());(this||o).header["content-type"]=(this||o).xhr.getResponseHeader("content-type");this._setHeaderProperties((this||o).header);null===(this||o).text&&e._responseType?(this||o).body=(this||o).xhr.response:(this||o).body="HEAD"!=(this||o).req.method?this._parseBody((this||o).text?(this||o).text:(this||o).xhr.response):null}l(Response.prototype);Response.prototype._parseBody=function(e){var t=f.parse[(this||o).type];if((this||o).req._parser)return(this||o).req._parser(this||o,e);!t&&isJSON((this||o).type)&&(t=f.parse["application/json"]);return t&&e&&(e.length||e instanceof Object)?t(e):null};Response.prototype.toError=function(){var e=(this||o).req;var t=e.method;var r=e.url;var s="cannot "+t+" "+r+" ("+(this||o).status+")";var n=new Error(s);n.status=(this||o).status;n.method=t;n.url=r;return n};f.Response=Response;function Request(e,t){var r=this||o;(this||o)._query=(this||o)._query||[];(this||o).method=e;(this||o).url=t;(this||o).header={};(this||o)._header={};this.on("end",(function(){var e=null;var t=null;try{t=new Response(r)}catch(t){e=new Error("Parser is unable to parse the response");e.parse=true;e.original=t;if(r.xhr){e.rawResponse="undefined"==typeof r.xhr.responseType?r.xhr.responseText:r.xhr.response;e.status=r.xhr.status?r.xhr.status:null;e.statusCode=e.status}else{e.rawResponse=null;e.status=null}return r.callback(e)}r.emit("response",t);var s;try{r._isResponseOK(t)||(s=new Error(t.statusText||"Unsuccessful HTTP response"))}catch(e){s=e}if(s){s.original=e;s.response=t;s.status=t.status;r.callback(s,t)}else r.callback(null,t)}))}u(Request.prototype);p(Request.prototype);Request.prototype.type=function(e){this.set("Content-Type",f.types[e]||e);return this||o};Request.prototype.accept=function(e){this.set("Accept",f.types[e]||e);return this||o};Request.prototype.auth=function(e,t,r){1===arguments.length&&(t="");if("object"===typeof t&&null!==t){r=t;t=""}r||(r={type:"function"===typeof btoa?"basic":"auto"});var encoder=function(e){if("function"===typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(e,t,r,encoder)};Request.prototype.query=function(e){"string"!=typeof e&&(e=serialize(e));e&&(this||o)._query.push(e);return this||o};Request.prototype.attach=function(e,t,r){if(t){if((this||o)._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this||o};Request.prototype._getFormData=function(){(this||o)._formData||((this||o)._formData=new a.FormData);return(this||o)._formData};Request.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=(this||o)._callback;this.clearTimeout();if(e){(this||o)._maxRetries&&(e.retries=(this||o)._retries-1);this.emit("error",e)}r(e,t)};Request.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=true;e.status=(this||o).status;e.method=(this||o).method;e.url=(this||o).url;this.callback(e)};Request.prototype.buffer=Request.prototype.ca=Request.prototype.agent=function(){console.warn("This is not supported in browser version of superagent");return this||o};Request.prototype.pipe=Request.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")};Request.prototype._isHost=function _isHost(e){return e&&"object"===typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)};Request.prototype.end=function(e){(this||o)._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent");(this||o)._endCalled=true;(this||o)._callback=e||noop;this._finalizeQueryString();return this._end()};Request.prototype._end=function(){var e=this||o;var t=(this||o).xhr=f.getXHR();var r=(this||o)._formData||(this||o)._data;this._setTimeouts();t.onreadystatechange=function(){var r=t.readyState;r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer);if(4==r){var s;try{s=t.status}catch(e){s=0}if(!s){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var handleProgress=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100);r.direction=t;e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=handleProgress.bind(null,"download");t.upload&&(t.upload.onprogress=handleProgress.bind(null,"upload"))}catch(e){}try{(this||o).username&&(this||o).password?t.open((this||o).method,(this||o).url,true,(this||o).username,(this||o).password):t.open((this||o).method,(this||o).url,true)}catch(e){return this.callback(e)}(this||o)._withCredentials&&(t.withCredentials=true);if(!(this||o)._formData&&"GET"!=(this||o).method&&"HEAD"!=(this||o).method&&"string"!=typeof r&&!this._isHost(r)){var s=(this||o)._header["content-type"];var n=(this||o)._serializer||f.serialize[s?s.split(";")[0]:""];!n&&isJSON(s)&&(n=f.serialize["application/json"]);n&&(r=n(r))}for(var i in(this||o).header)null!=(this||o).header[i]&&(this||o).header.hasOwnProperty(i)&&t.setRequestHeader(i,(this||o).header[i]);(this||o)._responseType&&(t.responseType=(this||o)._responseType);this.emit("request",this||o);t.send("undefined"!==typeof r?r:null);return this||o};f.agent=function(){return new c};["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(e){c.prototype[e.toLowerCase()]=function(t,r){var s=new f.Request(e,t);this._setDefaults(s);r&&s.end(r);return s}}));c.prototype.del=c.prototype["delete"];f.get=function(e,t,r){var s=f("GET",e);"function"==typeof t&&(r=t,t=null);t&&s.query(t);r&&s.end(r);return s};f.head=function(e,t,r){var s=f("HEAD",e);"function"==typeof t&&(r=t,t=null);t&&s.query(t);r&&s.end(r);return s};f.options=function(e,t,r){var s=f("OPTIONS",e);"function"==typeof t&&(r=t,t=null);t&&s.send(t);r&&s.end(r);return s};function del(e,t,r){var s=f("DELETE",e);"function"==typeof t&&(r=t,t=null);t&&s.send(t);r&&s.end(r);return s}f["del"]=del;f["delete"]=del;f.patch=function(e,t,r){var s=f("PATCH",e);"function"==typeof t&&(r=t,t=null);t&&s.send(t);r&&s.end(r);return s};f.post=function(e,t,r){var s=f("POST",e);"function"==typeof t&&(r=t,t=null);t&&s.send(t);r&&s.end(r);return s};f.put=function(e,t,r){var s=f("PUT",e);"function"==typeof t&&(r=t,t=null);t&&s.send(t);r&&s.end(r);return s};var y=i;const m=i.Request;export default y;export{m as Request};

